/**
*******************************************************************************
**
**  @file               state_machine.c
**  @brief              File description
**  @par				Detail description
**
**  @version            0.1.0
**  @date               2017-12-10
**
*******************************************************************************
**
**  @author				Javier Peces
**  @copyright
**
*******************************************************************************
**
**  @par VERSION HISTORY
**  @par
**  Version  | Date        | Revised by        | Description
**  -------- | ----------- | ----------------- | -----------------------------
** 	0.1.0    | 2017-12-10  | Javier Peces	   | File creation
**
*******************************************************************************
**/



#define STATE_MACHINE_C_


/******************************************************************************
**             			MODULES USED                           			 	 **
******************************************************************************/
#include "state_machine.h"


/******************************************************************************
**						DEFINITIONS AND MACROS                          	 **
******************************************************************************/


/******************************************************************************
**                      TYPEDEFS AND STRUCTURES                              **
******************************************************************************/


/******************************************************************************
**                      PROTOTYPES OF LOCAL FUNCTIONS                        **
******************************************************************************/
void STM_executeState(STM_STATE *state , STM_MACHINE *machine);

/******************************************************************************
**                     	GLOBAL VARIABLES                                 	 **
******************************************************************************/


/******************************************************************************
**                      PUBLIC FUNCTIONS                                     **
******************************************************************************/
void STM_execute(STM_MACHINE *machine)
 {
	STM_STATE **state;    /* tracking index value */

	if (machine->StopCond())  return;

	for (state = machine->state; *state != NULL; ++state)
	{
		if (machine->id_act_st == (*state)->id)
		{
			STM_executeState(*state , machine);
			return;
		}
	}
 }


 void STM_executeState(STM_STATE *state , STM_MACHINE *machine)
 {
 	STM_EVEACC *Indx;   /* tracking index value */

 	(*state->controls)();

 	for (Indx = state->transitions; Indx->event != NULL; ++Indx)
 	{
 		if (Indx->event() == TRUE)
 		{
 			if (Indx->action != NULL)
 			{
 				Indx->action();
 			}
 			if (Indx->next_id != machine->id_act_st)
 			{
 				machine->id_act_st = Indx->next_id;
 				return;
 			}

 		}
 	}
 }

/******************************************************************************
**                      LOCAL FUNCTIONS                                  	 **
******************************************************************************/


/******************************************************************************
**                      EOF				                                     **
******************************************************************************/
